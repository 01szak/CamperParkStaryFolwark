<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Guests Management</title>
    <style>

        .guest_list{
            table, th, td {
                text-align: center;
                border: 1px solid black;
            }
        }
        tr[data-href]{

            cursor: pointer;

        }

    </style>
</head>
<body>

<div class="guest_list">
    <form>
        <form id="sortForm" method="get" >

            <label th:text=" ${sortOrderDirection}">

            </label>
            <input type="checkbox" id="sortOrder" name="sortOrder" value="desc">
<!--            <input type="hidden" name="sortOrder" value="asc" id="sortOrderHidden">-->
            <button> sort </button>

        </form>
        <table>

    <thead>

<tr>
    <th>Guest Name</th>
    <th>occupiedPlace</th>
</tr>

</thead>
<tbody>

        <tr data-href="@{/admin/aboutGuest}" th:each="tempGuest : ${guests}">

        <td th:text="${tempGuest.firstName} + ${tempGuest.lastName}"/>
        <td th:text="${tempGuest.occupiedPlace}"/>

    </tr>

</tbody>


        </table>
        <script>
            document.getElementById("sortOrder").addEventListener("change", () => {
                console.log('test')
                var checkbox = document.getElementById("sortOrder");

                if (checkbox.checked) {
                    checkbox.value = "desc"; // Ustaw sortowanie malejące
                } else {
                    checkbox.value = "asc";  // Ustaw sortowanie rosnące
                }

                const form = document.getElementById('sortForm')
                form.submit()
            });

        </script>

        <script>

            document.addEventListener("DOMContentLoaded", () =>{
                console.log('test')
                const rows = document.querySelectorAll("tr[data-href]");

                rows.forEach(row =>{
                    row.addEventListener("click", () => {

                        localStorage.setItem("clickedRow", row.dataset.href);

                        window.location.href = row.dataset.href;

                    })
                })

            })

        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                console.log('test');
                const rows = document.querySelectorAll("tr[data-href]");

                rows.forEach(row => {
                    row.addEventListener("click", () => {
                        // Wysłanie informacji o kliknięciu na serwer
                        fetch('/api/save-click', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ clickedRow: row.dataset.href })
                        })
                            .then(response => response.json())
                            .then(data => {
                                console.log('Dane zapisane:', data);
                            })
                            .catch(error => {
                                console.error('Błąd:', error);
                            });

                        // Przekierowanie użytkownika
                        window.location.href = row.dataset.href;
                    });
                });
            });
        </script>



    </form>
</div>



</body>
</html>